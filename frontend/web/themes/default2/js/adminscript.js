function timeConverter(t){var a=new Date(1e3*t),d=a.getFullYear(),e=a.getMonth(),i=a.getDate(),s=a.getHours(),r=a.getMinutes(),o=a.getSeconds(),n=i+"-"+e+"-"+d+"   "+s+"."+r+"."+o;return n}$(document).on("click",".settings",function(){window.location="/admin"}),$(document).on("click",".admin-orders-data-phantom",function(){$(this).children().modal("show")}),$(document).on("click",".admin-orders-adress-phantom",function(){$(this).children().children().modal("show")}),$(document).on("click",".admin-order-adress",function(){$(this).children().children().modal("close")}),$(document).on("click",".admin-orders-data",function(){$(this).children().children().modal("close")}),$(document).on("click",".users",function(){$.ajax({url:"/admin/default/requestusers",data:"cat=1",cache:!1,async:!0,dataType:"json",success:function(t){$(".bside").html(""),$inner='<div class="admin-users-row"><div class="admin-users-num-header">№ п/п</div><div class="admin-users-name-header">Логин</div><div class="admin-users-mail-header">E-mail</div><div class="admin-users-date-reg-header">Зарегистрирован</div><div class="admin-users-date-update-header">Профиль обновлен</div></div>',$innercount="",$.each(t,function(){$inner+='<div class="admin-users-row"><div class="admin-users-num">'+$innercount++ +'</div><div class="admin-users-name">'+this.username+'</div><div class="admin-users-mail">'+this.email+'</div><div class="admin-users-date-reg">'+timeConverter(this.created_at)+'</div><div class="admin-users-date-update">'+timeConverter(this.updated_at)+"</div></div>"}),$(".bside").append($inner)}})}),$(document).on("click",".orders",function(){$pagenav=0,$("[data-page-nav]").length>0?($page=$("[data-page-nav]"),$page=parseInt($page[0].getAttribute("data-page-nav"))):$page=0,-1!=this.getAttribute("class").indexOf("nav-next")?$page+=1:-1!=this.getAttribute("class").indexOf("nav-prev")&&($page+=-1),$.ajax({url:"/admin/default/requestorders",data:"cat=1&nav="+$pagenav+"&page="+$page,cache:!1,async:!0,success:function(t){$statusarr=new Object,$statusarr[100]="Обработка заказа",$statusarr[1]="Обработка заказа",$statusarr[2]="Ждём оплаты",$statusarr[3]="Оплачен",$statusarr[4]="Оплачен - Доставляется",$statusarr[5]="Оплачен - Доставлен",$statusarr[6]="Отменён",$statusarr[11]="Сборка",$statusarr[0]="Спецпредложение",$statusinner="",void 0!=t.ordersatus?($orders=t.ordersatus,delete t.ordersatus,$page=t.page,delete t.page):$orders="",$(".bside").html(""),$inner='<div class="admin-orders-row"><div class="admin-orders-num-header">№ п/п</div><div class="admin-orders-id-header">Идентификатор</div><div class="admin-orders-name-header">Заказчик</div><div class="admin-orders-data-head">Заказ</div><div class="admin-order-adress-header">Адрес</div><div class="admin-order-status-header">Статус</div><div class="admin-order-adress-header">Управление</div></div>',$innercount="",$.each(t,function(){0!=this&&($innerdata="",$adress="",$dataq=this.order,void 0==this.delivery?$dataadress="":$dataadress=this.delivery,1==this.status?($status='<div class="admin-order-status">Новый</div>',$statusinner='<i class="fa fa-truck admin-orders-navigation-control" data-toggle="tooltip" data-placement="top" title="Доставить в магазин" id="order-to-storage"></i><i id="order-to-user"  data-toggle="tooltip" data-placement="top" title="Доставить клиенту"  class="fa fa-user admin-orders-navigation-control"></i><i id="cancel-order" data-toggle="tooltip" data-placement="top" title="Отмена заказа" class="fa fa-close admin-orders-navigation-control"></i>'):0==this.status?($status='<div class="admin-order-status">Отменен</div>',$statusinner='<i class="fa fa-truck admin-orders-navigation-control-inactive" data-toggle="tooltip" data-placement="top" title="Доставить в магазин" ></i><i   data-toggle="tooltip" data-placement="top" title="Доставить клиенту"  class="fa fa-user admin-orders-navigation-control-inactive"></i><i  data-toggle="tooltip" data-placement="top" title="Отмена заказа" class="fa fa-close admin-orders-navigation-control-inactive"></i>'):10==this.status?$statusinner='<i class="fa fa-truck admin-orders-navigation-control-active" data-toggle="tooltip" data-placement="top" title="Доставить в магазин" ></i><i  data-toggle="tooltip" data-placement="top" title="Доставить клиенту"  class="fa fa-user admin-orders-navigation-control-inactive"></i><i  data-toggle="tooltip" data-placement="top" title="Отмена заказа" class="fa fa-close admin-orders-navigation-control-inactive"></i>':20==this.status?$statusinner='<i class="fa fa-truck admin-orders-navigation-control-inactive" data-toggle="tooltip" data-placement="top" title="Доставить в магазин" ></i><i   data-toggle="tooltip" data-placement="top" title="Доставить клиенту"  class="fa fa-user admin-orders-navigation-control-active"></i><i  data-toggle="tooltip" data-placement="top" title="Отмена заказа" class="fa fa-close admin-orders-navigation-control-inactive"></i>':($status='<div class="admin-order-status">Ошибка</div>',$statusinner='<i class="fa fa-truck admin-orders-navigation-control" data-toggle="tooltip" data-placement="top" title="Доставить в магазин" ></i><i id="order-to-user"  data-toggle="tooltip" data-placement="top" title="Доставить клиенту"  class="fa fa-user admin-orders-navigation-control"></i><i  data-toggle="tooltip" data-placement="top" title="Отмена заказа" class="fa fa-close admin-orders-navigation-control"></i>'),$dataordersnum=this.orders_id,$dataorderinfo=$orders[$dataordersnum],void 0==this.orders_id?void 0!=this.order?($.each($dataq,function(){$innerdata+='<div style="clear: both;" class="admin-order-show"><div class="admin-orders-prodimg" style="float: left;  max-height: 100px; max-width: 180px; min-height: 100px; min-width: 180px;  background: #fff no-repeat scroll 50% 50% / contain url(http://odezhda-master.ru/images/'+this[5]+');"></div><div class="admin-orders-prodid">'+this[0]+'</div><div class="admin-orders-prodmodel">'+this[1]+'</div><div class="admin-orders-prodsize">'+this[6]+'</div><div class="admin-orders-prodcount">'+this[4]+"</div></div>"}),$adress+='<div><div id="user-country"><b>Страна: </b>'+$dataadress.country+'</div><div id="user-state"><b>Область/регион: </b>'+$dataadress.state+'</div><div id="user-city"><b>Город: </b>'+$dataadress.city+'</div><div id="user-adress"><b>Адрес: </b>'+$dataadress.adress+'</div><div id="user-postcode"><b>Почтовый код: </b>'+$dataadress.postcode+'</div><div id="user-lastname"><b>Фамилия: </b>'+$dataadress.lastname+'</div><div id="user-name"><b>Имя: </b>'+$dataadress.name+'</div><div id="user-secondname"><b>Отчество: </b>'+$dataadress.secondname+'</div><div id="user-telephone"><b>Телефон: </b>'+$dataadress.telephone+'</div><div id="user-pasportser"><b>Серия паспорта: </b>'+$dataadress.pasportser+'</div><div id="user-pasportnum"><b>Номер паспорта: </b>'+$dataadress.pasportnum+'</div><div id="user-pasportwhere"><b>Кем выдан: </b>'+$dataadress.pasportwhere+'</div><div id="user-pasportdate"><b>Когда выдан: </b>'+$dataadress.pasportdate+"</div></div>"):$innerdata="Ошибка чтения из базы":this.orders_id>0?($status='<div class="admin-order-status2">'+$statusarr[$dataorderinfo.orders_status]+"</div>",$adress+='<div><div id="user-country"><b>Страна: </b>'+$dataadress.country+'</div><div id="user-state"><b>Область/регион: </b>'+$dataadress.state+'</div><div id="user-city"><b>Город: </b>'+$dataadress.city+'</div><div id="user-adress"><b>Адрес: </b>'+$dataadress.adress+'</div><div id="user-postcode"><b>Почтовый код: </b>'+$dataadress.postcode+'</div><div id="user-lastname"><b>Фамилия: </b>'+$dataadress.lastname+'</div><div id="user-name"><b>Имя: </b>'+$dataadress.name+'</div><div id="user-secondname"><b>Отчество: </b>'+$dataadress.secondname+'</div><div id="user-telephone"><b>Телефон: </b>'+$dataadress.telephone+'</div><div id="user-pasportser"><b>Серия паспорта: </b>'+$dataadress.pasportser+'</div><div id="user-pasportnum"><b>Номер паспорта: </b>'+$dataadress.pasportnum+'</div><div id="user-pasportwhere"><b>Кем выдан: </b>'+$dataadress.pasportwhere+'</div><div id="user-pasportdate"><b>Когда выдан: </b>'+$dataadress.pasportdate+"</div></div>",$prod_content="",$resultprice=0,$resultcount=0,$resultcountpos=0,$oldresultprice=0,$oldresultcount=0,$oldresultcountpos=0,$resultpricewithdiscount=0,$resultpricewithdiscountolder=0,$.each($dataorderinfo.products,function(t){0==this.products_quantity?($raw_style='style="background: rgb(255, 92, 92) none repeat scroll 0% 0%;"',$prod_stat="Нет в наличии!"):this.products_quantity===this.first_quant?($raw_style='style="background: #45B74A  none repeat scroll 0% 0%;"',$prod_stat="Количество соответствует"):($raw_style='style="background: #ECE37F none repeat scroll 0% 0%;"',$prod_stat="Количество измененно"),$checkattr=this.orders_products_id,$attr="",$snprice=0,$snpricehtml="",$.each($dataorderinfo.productsAttr,function(){this.orders_products_id==$checkattr&&($attr=this.products_options_values)}),""!=$attr?$prod_atr=$attr:$prod_atr="Без размера",$resultprice+=parseInt(this.products_quantity)*parseInt($dataorderinfo.products[t].products_price),$oldresultprice+=parseInt(this.first_quant)*parseInt($dataorderinfo.products[t].products_price),$resultcount+=parseInt(this.products_quantity),$oldresultcount+=parseInt(this.first_quant),$oldresultcountpos+=1,$dataorderinfo.discount>0?($snprice=parseInt($dataorderinfo.products[t].products_price)+parseInt($dataorderinfo.products[t].products_price)/100*parseInt($dataorderinfo.discount),$snpricehtml='<div>С учетом наценки <font color="red">'+this.products_quantity+"x"+$snprice+" Руб.</font></div>",$snpricehtmlin='<p>С учетом наценки <font color="red">'+this.products_quantity*$snprice+" Руб.</font></p>",$resultpricewithdiscount+=parseInt(this.products_quantity)*(parseInt($dataorderinfo.products[t].products_price)+parseInt($dataorderinfo.products[t].products_price)/100*parseInt($dataorderinfo.discount)),$resultpricewithdiscountolder+=parseInt(this.first_quant)*(parseInt($dataorderinfo.products[t].products_price)+parseInt($dataorderinfo.products[t].products_price)/100*parseInt($dataorderinfo.discount))):($resultpricewithdiscount+=0,$resultpricewithdiscountolder+=0,$snpricehtml="",$snpricehtmlin=""),0!=parseInt(this.products_quantity)&&($resultcountpos+=1),$prod_content+='<div class="row-prod"><div class="prod-content-raw" '+$raw_style+'><div class="admin-orders-prodimg" style="float: left;  max-height: 100px; max-width: 180px; min-height: 100px; min-width: 180px;  background: #fff no-repeat scroll 50% 50% / contain url(http://odezhda-master.ru/images/'+$dataq[t][5]+');"></div><div>'+$prod_stat+'</div></div><div class="colone"><div class="prod-content-count">'+this.products_quantity+"х"+this.products_name+'</div><div class="prod-content-attr">Размер: '+$prod_atr+'</div></div><div  class="coltwo"><div class="prod-content-code">'+$dataorderinfo.products[t].products_model+'</div></div><div  class="colthree"><div class="prod-content-price">'+this.products_quantity+"х"+parseInt($dataorderinfo.products[t].products_price)+" Руб.</div>"+$snpricehtml+'</div><div class="prod-content-priceallraw">'+parseInt(this.products_quantity)*parseInt($dataorderinfo.products[t].products_price)+" Руб."+$snpricehtmlin+"</div></div>"}),$resultpricewithdiscount>0?($resultpricewithdiscounthtml="<div>Результирующая наценка составила "+$dataorderinfo.discount+' %</div><div> Стоимость для клиента с учетом наценки составила <font color="red">'+$resultpricewithdiscount+" Руб.</font></div>",$resultpricewithdiscountolderhtml="<div>Результирующая наценка составила "+$dataorderinfo.discount+' %</div><div> Стоимость для клиента с учетом наценки составила <font color="red">'+$resultpricewithdiscount+" Руб.</font></div>"):($resultpricewithdiscounthtml="",$resultpricewithdiscountolderhtml=""),$prod_content+='<div class="result-prod"><div class="old-prod-order"><div>Товаров в наличии: '+$resultcount+" позиций: "+$resultcountpos+'</div><div><font color="red">Новая сумма товаров в заказе: '+$resultprice+" Руб.</font></div>"+$resultpricewithdiscounthtml+'</div><div class="new-prod-order"><div>Товаров в заказе '+$oldresultcount+" позиций: "+$oldresultcountpos+"</div><div>Сумма товаров в заказе: "+$oldresultprice+" Руб.</div>"+$resultpricewithdiscountolderhtml+"</div></div>",$innerdata+='<div class="admin-order-om-wrap" style="height: 100%; width:100%"><div class="admin-order-om-show">'+$dataorderinfo.orders_id+'</div><div class="admin-order-om-adress">'+$dataorderinfo.delivery_country+", "+$dataorderinfo.delivery_state+", "+$dataorderinfo.delivery_city+", "+$dataorderinfo.delivery_street_address+", "+$dataorderinfo.delivery_postcode+'</div><div class="admin-order-om-name">'+$dataorderinfo.delivery_lastname+" "+$dataorderinfo.delivery_name+" "+$dataorderinfo.delivery_otchestvo+'</div><div class="admin-order-om-prod-container">'+$prod_content+"</div></div>"):($status='<div class="admin-order-status3">Новый</div>',$statusinner='<i class="fa fa-truck admin-orders-navigation-control" data-toggle="tooltip" data-placement="top" title="Доставить в магазин" id="order-to-storage"></i><i id="order-to-user"  data-toggle="tooltip" data-placement="top" title="Доставить клиенту"  class="fa fa-user admin-orders-navigation-control"></i><i id="cancel-order" data-toggle="tooltip" data-placement="top" title="Отмена заказа" class="fa fa-close admin-orders-navigation-control"></i>'),$inner+='<div class="admin-orders-row"><div class="admin-orders-num">'+($innercount++ +10*$page)+'</div><div class="admin-orders-id">'+this.id+'</div><div class="admin-orders-name">'+$dataadress.lastname+" "+$dataadress.name+" "+$dataadress.secondname+'</div><div class="admin-orders-data-phantom"><div data-tog="'+$innercount+'" class="admin-orders-data  modal"><div style="padding: 10px; overflow: auto; background: rgb(251, 251, 251) none repeat scroll 0% 0%; box-shadow: 0px 0px 7px 1px rgb(180, 180, 180); height: 100%;"><div data-tog="'+$innercount+'" id="admclose">x</div>'+$innerdata+'</div></div></div><div class="admin-orders-adress-phantom"><div><div data-tog="'+$innercount+'" class="admin-order-adress modal"><div data-tog="'+$innercount+'" id="admclose">x</div>'+$adress+"</div></div></i></div>"+$status+'<div data-navorder="'+this.id+'" class="admin-orders-navigation">'+$statusinner+"</div></div>")}),$pager="",$pager+=' <div data-page="" class="page orders nav-prev btn btn-default btn-sm" href="#"><i class="fa fa-chevron-left"><a href="#"></a></i></div> ',$pager+=' <div data-page="" class="page  orders nav-next  btn btn-default btn-sm" href="#"><i class="fa fa-chevron-right"><a href="#"></a></i></div> ',$(".bside").append('<div data-page-nav="'+$page+'">'+$inner+$pager+"</div>")}})}),$(document).on("click","#cancel-order",function(){$id=$(this).parent().siblings("div.admin-orders-id")[0].textContent,$(".accept").remove(),$("html").append('<div class="modal accept"><div class="diax">Вы подтверждаете отмену заказа № '+$id+' ?<div></div><button class="button-accept-cancel btn btn-info btn-sm"  style="margin: 20px;" data-id="'+$id+'">да</button><button class="close-button-accept btn btn-danger btn-sm"  style="margin: 20px;">нет</button></div></div>'),$(".accept").show()}),$(document).on("click","#order-to-storage",function(){$id=$(this).parent().siblings("div.admin-orders-id")[0].textContent,$self=1,$where="на адрес вашего магазина?",$(".accept").remove(),$("html").append('<div class="modal accept"><div class="diax">Вы подтверждаете отправку заказа № '+$id+" "+$where+'<div></div><button class="button-accept-delegate btn btn-info btn-sm"  style="margin: 20px;" data-id="'+$id+'" data-where="'+$self+'">да</button><button class="close-button-accept btn btn-danger btn-sm"  style="margin: 20px;">нет</button></div></div>'),$(".accept").show()}),$(document).on("click","#order-to-user",function(){$id=$(this).parent().siblings("div.admin-orders-id")[0].textContent,$self=0,$where="на адрес вашего клиента?",$(".accept").remove(),$("html").append('<div class="modal accept"><div class="diax">Вы подтверждаете отправку заказа № '+$id+" "+$where+'<div></div><button class="button-accept-delegate btn btn-info btn-sm"  style="margin: 20px;" data-id="'+$id+'" data-where="'+$self+'">да</button><button class="close-button-accept btn btn-danger btn-sm"  style="margin: 20px;">нет</button></div></div>'),$(".accept").show()}),$(document).on("click",".close-button-accept",function(){$(".accept").remove(),$("input:checked").removeAttr("checked")}),$(document).on("click",".button-accept-delegate",function(){$id=this.getAttribute("data-id"),$self=this.getAttribute("data-where"),$("[data-navorder="+$id+"]").html("Отправка"),$(".accept").remove(),$("input:checked").removeAttr("checked"),$(this).html("Отправка заказа").addClass("admin-order-status2").removeClass("admin-order-status"),$.ajax({type:"POST",async:!0,url:"/admin/default/delegate",data:{id:$id,self:$self},cache:!1,dataType:"json",complete:function(t,a,d){$id=this.data.split("&")[0].split("=")[1],$("[data-navorder="+$id+"]").html(200===t.status?"Отправлено":"Ошибка")}})}),$(document).on("click",".button-accept-cancel",function(){$id=this.getAttribute("data-id"),$(".accept").remove(),$("input:checked").removeAttr("checked"),$(this).html("Отправка заказа").addClass("admin-order-status2").removeClass("admin-order-status"),$("[data-navorder="+$id+"]").html("Отмена"),$.ajax({type:"POST",url:"/admin/default/cancelorder",data:{id:$id},cache:!1,async:!0,dataType:"json",statuscode:{200:function(){$(".admin-order-status2").html("ОК")},404:function(){$(".admin-order-status2").html("Не доступно")},500:function(){$(".admin-order-status2").html("Ошибка обработки")}}})}),$(document).on("click","#admclose",function(){$cl=this.getAttribute("data-tog"),$("[data-tog="+$cl+"]").modal("hide")});